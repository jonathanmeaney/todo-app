<!DOCTYPE html>
<html>
<head>
<title>tutorial.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="rails-4-tutorial---todo-app">Rails 4 Tutorial - ToDo App</h1>
<p>This tutorial covers creating a ToDo application using Ruby on Rails. The ToDo application will have a few parts.</p>
<ol>
<li>User authentication (User creation, login etc).</li>
<li>ToDo create, read, update, destroy (C.R.U.D).</li>
</ol>
<p>The completed code can be found on my <a href="https://github.com/jonathanmeaney/todo-app">ToDo App Repository</a>.</p>
<h2 id="1-directory-setup">1. Directory setup</h2>
<p>Open a new terminal window. Lets create a directory called <code>Development</code> in your home directory. This will be where we keep development work. Create a sub directory under <code>Development</code> called <code>rails</code>. The following commands will create the directory structure.</p>
<pre class="hljs"><code><div>cd
mkdir Development
cd Development
mkdir rails
cd rails
</div></code></pre>
<h2 id="2-create-and-setup-the-rails-app">2. Create and setup the Rails app</h2>
<p>Now that the <code>Development</code> directory and <code>rails</code> directory are created we can create the new rails app.</p>
<h3 id="21-check-version-of-bundler-gem">2.1 Check version of Bundler gem</h3>
<p>You might need to install an different version of the <code>bundler</code> gem. Rails <code>4.2.11.3</code> requires less than version 2. To check which version you have run:</p>
<pre class="hljs"><code><div>gem list bundler
</div></code></pre>
<p>And you will see something like</p>
<pre class="hljs"><code><div>$ gem list bundler

*** LOCAL GEMS ***

bundler (2.0.1)
</div></code></pre>
<p>If you don't have a version less than 2 then you can run this command to install it.</p>
<pre class="hljs"><code><div>gem install bundler -v '1.17.3'
</div></code></pre>
<p>You will then need to uninstall the <code>2.0.1</code> version.</p>
<pre class="hljs"><code><div>gem uninstall bundler -v '2.0.1'
</div></code></pre>
<h3 id="22-create-the-rails-app">2.2 Create the Rails app</h3>
<p>Run the following command from the <code>Development/rails</code> directory in the terminal.</p>
<pre class="hljs"><code><div>rails new todo-app -d mysql -T
</div></code></pre>
<p>The <code>-d</code> flag allows you to specify which database should be used by the new application, we're specifying <code>mySQL</code> here.
The <code>-T</code> flag will tell Rails not to generate a test suite. We will do this separately later.</p>
<h3 id="221-rails-app-structure">2.2.1 Rails App Structure</h3>
<p>You can find an in depth overview of <code>Rails 4.2</code> on the official Rails website. https://guides.rubyonrails.org/v4.2/getting_started.html</p>
<table class="responsive">
<thead>
<tr>
<th>File/Folder</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>app/</td>
<td>Contains the controllers, models, views, helpers, mailers and assets for your application. You'll focus on this folder for the remainder of this guide.</td>
</tr>
<tr>
<td>bin/</td>
<td>Contains the rails script that starts your app and can contain other scripts you use to setup, deploy or run your application.</td>
</tr>
<tr>
<td>config/</td>
<td>Configure your application's routes, database, and more. This is covered in more detail in <a href="https://guides.rubyonrails.org/v4.2/configuring.html">Configuring Rails Applications</a>.</td>
</tr>
<tr>
<td>config.ru</td>
<td>Rack configuration for Rack based servers used to start the application.</td>
</tr>
<tr>
<td>db/</td>
<td>Contains your current database schema, as well as the database migrations.</td>
</tr>
<tr>
<td>Gemfile<br>Gemfile.lock</td>
<td>These files allow you to specify what gem dependencies are needed for your Rails application. These files are used by the Bundler gem. For more information about Bundler, see the <a href="http://bundler.io">Bundler website</a>.</td>
</tr>
<tr>
<td>lib/</td>
<td>Extended modules for your application.</td>
</tr>
<tr>
<td>log/</td>
<td>Application log files.</td>
</tr>
<tr>
<td>public/</td>
<td>The only folder seen by the world as-is. Contains static files and compiled assets.</td>
</tr>
<tr>
<td>Rakefile</td>
<td>This file locates and loads tasks that can be run from the command line. The task definitions are defined throughout the components of Rails. Rather than changing Rakefile, you should add your own tasks by adding files to the lib/tasks directory of your application.</td>
</tr>
<tr>
<td>README.rdoc</td>
<td>This is a brief instruction manual for your application. You should edit this file to tell others what your application does, how to set it up, and so on.</td>
</tr>
<tr>
<td>tmp/</td>
<td>Temporary files (like cache, pid, and session files).</td>
</tr>
<tr>
</tbody>
</table>
<h3 id="222-database-credentials">2.2.2 Database credentials</h3>
<p><code>cd</code> into the <code>todo-app</code> application directory and open it in <code>VS Code</code>. We need to update some configuration. The file <code>config/database.yml</code> contains the credentials required for connecting to the database so those will need to be updated to let the app connect. Give the <code>username</code> and <code>password</code> that you set when installing <code>mySQL</code>. This is what my default config looks like from <code>config/database.yml</code>.</p>
<pre class="hljs"><code><div><span class="hljs-attr">default:</span> <span class="hljs-meta">&amp;default</span>
  <span class="hljs-attr">adapter:</span> <span class="hljs-string">mysql2</span>
  <span class="hljs-attr">encoding:</span> <span class="hljs-string">utf8</span>
  <span class="hljs-attr">pool:</span> <span class="hljs-number">5</span>
  <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>
  <span class="hljs-attr">password:</span> <span class="hljs-string">root</span>
  <span class="hljs-attr">socket:</span> <span class="hljs-string">/tmp/mysql.sock</span>
</div></code></pre>
<h3 id="223-create-databases">2.2.3 Create Databases</h3>
<p>Now tha the credentials are specified the application should be able to access <code>mySQL</code>. We'll use Rake to run a command to create the databases. <code>Rake</code> is a task runner and is used for running some automated tasks in <code>Rails</code>. One of these tasks is to create the databases the app is going to use. To do that you can run.</p>
<pre class="hljs"><code><div>bundle exec rake db:create
</div></code></pre>
<p>This will create the <code>todo-app_development</code> and <code>todo-app_test</code> databases. The <code>_development</code> database is where the app data will live and the <code>_test</code> database is used during automated tests.</p>
<h3 id="224-test-the-server">2.2.4 Test the server</h3>
<p>Now that the database is setup lets test that the server will start. Run the following command to start the server:</p>
<pre class="hljs"><code><div>bundle exec rails s
</div></code></pre>
<p>This will start the server and you can access it from the browser if you visit <code>http://localhost:3000/</code>. If all has gone well then you will see this page.
<img src="screenshots/new_app_server_page.png" alt="localhost">
If you see this then everything has been successful so far! You can stop the server by pressing <code>ctrl+c</code> so do that now, we are going to make some changes the server should be stopped for.</p>
<h2 id="3-adding-rspec">3 Adding RSpec</h2>
<p>We use RSpec for testing. https://rspec.info/ and documentation https://relishapp.com/rspec</p>
<h3 id="31-adding-gems-required-for-rspec">3.1 Adding gems required for RSpec</h3>
<p>We need to add the gems required for RSpec to the <code>Gemfile</code>. Add <code>gem 'rspec-rails', '~&gt; 3.9'</code> to the <code>Gemfile</code> inside the <code>:development, :test</code> group. This is how it should look after adding the gem.</p>
<pre class="hljs"><code><div>group <span class="hljs-symbol">:development</span>, <span class="hljs-symbol">:test</span> <span class="hljs-keyword">do</span>
  <span class="hljs-comment"># Call 'byebug' anywhere in the code to stop execution and get a debugger console</span>
  gem <span class="hljs-string">'byebug'</span>
  gem <span class="hljs-string">'rspec-rails'</span>, <span class="hljs-string">'~&gt; 3.9'</span>
<span class="hljs-keyword">end</span>
</div></code></pre>
<p>After adding the gem then from the terminal in the <code>todo-app</code> root directory run:</p>
<pre class="hljs"><code><div>bundle install
</div></code></pre>
<p>This will install the gems. You should see something like this in the output.</p>
<pre class="hljs"><code><div>Installing rspec-support 3.9.4
Fetching rspec-core 3.9.3
Installing rspec-core 3.9.3
Fetching rspec-expectations 3.9.3
Installing rspec-expectations 3.9.3
Using rspec-mocks 3.9.1
Fetching rspec-rails 3.9.1
Installing rspec-rails 3.9.1
</div></code></pre>
<h3 id="32-generating-boilerplate-configuration-for-rspec">3.2 Generating boilerplate configuration for RSpec</h3>
<p>After installing the RSpec gems we need to generate the boilerplate configuration for them to use. We will use the Rails <code>generate</code> command to do this. From the terminal in the <code>todo-app</code> root directory run:</p>
<pre class="hljs"><code><div>bundle exec rails generate rspec:install
</div></code></pre>
<p>You should see this output:</p>
<pre class="hljs"><code><div>create  .rspec
create  spec
create  spec/spec_helper.rb
create  spec/rails_helper.rb
</div></code></pre>
<p>The generator has created a new directory in our application called <code>spec</code> along with some helper classes. This directory is where all our tests will live. RSpec should now be configured for use with our application.</p>
<h2 id="4-pushing-to-github">4 Pushing to Github</h2>
<p>Now the basic app skeleton is created lets create a repo on Github for the application and push up what we have so far.</p>
<h3 id="41-create-the-repository-on-github-for-the-todo-app">4.1 Create the repository on Github for the Todo App</h3>
<p>Login to Github and go to https://github.com/new to create a new repository. Give the repository the name <code>todo-app</code> and a description if you life. The form will look like this.</p>
<p><img src="screenshots/new_repo_form.png" alt="New Repository Form"></p>
<p>And when you click on <code>Create repository</code> you should see the empty repository like so:</p>
<p><img src="screenshots/new_repo.png" alt="New Repository"></p>
<p>At the moment the repository is empty so lets fix that.</p>
<p>### 4.2 Initialize the ToDo App for Github</p>
<p>From the <code>todo-app</code> root directory run the following command to initialize the directory for use with Github.</p>
<pre class="hljs"><code><div>git init
</div></code></pre>
<p>If you now run:</p>
<pre class="hljs"><code><div>git status
</div></code></pre>
<p>It will print out some info about the local repository such as what branch you're on and what files have been changes since the last push to Github. It will look like this at the moment.</p>
<pre class="hljs"><code><div>On branch master

No commits yet

Untracked files:
  (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)

        .gitignore
        Gemfile
        Gemfile.lock
        README.rdoc
        Rakefile
        app/
        bin/
        config.ru
        config/
        db/
        lib/
        log/
        public/
        vendor/
</div></code></pre>
<p>### 4.3 Adding files
Currently none of the files in the <code>todo-app</code> root directory are added to the repository. To add them all run:</p>
<pre class="hljs"><code><div>git add .
</div></code></pre>
<p>After that running <code>git status</code> again will show that all the files have been added and will look like so:</p>
<pre class="hljs"><code><div>On branch master

No commits yet

Changes to be committed:
  (use &quot;git rm --cached &lt;file&gt;...&quot; to unstage)

        new file:   .gitignore
        new file:   Gemfile
        new file:   Gemfile.lock
        new file:   README.rdoc
        new file:   Rakefile
        new file:   app/assets/images/.keep
        new file:   app/assets/javascripts/application.js
        new file:   app/assets/stylesheets/application.css
        new file:   app/controllers/application_controller.rb
        new file:   app/controllers/concerns/.keep
        new file:   app/helpers/application_helper.rb
        new file:   app/mailers/.keep
        new file:   app/models/.keep
        new file:   app/models/concerns/.keep
        new file:   app/views/layouts/application.html.erb
        new file:   bin/bundle
        new file:   bin/rails
        new file:   bin/rake
        new file:   bin/setup
        new file:   config.ru
        new file:   config/application.rb
        new file:   config/boot.rb
        new file:   config/database.yml
        new file:   config/environment.rb
        new file:   config/environments/development.rb
        new file:   config/environments/production.rb
        new file:   config/environments/test.rb
        new file:   config/initializers/assets.rb
        new file:   config/initializers/backtrace_silencers.rb
        new file:   config/initializers/cookies_serializer.rb
        new file:   config/initializers/filter_parameter_logging.rb
        new file:   config/initializers/inflections.rb
        new file:   config/initializers/mime_types.rb
        new file:   config/initializers/session_store.rb
        new file:   config/initializers/to_time_preserves_timezone.rb
        new file:   config/initializers/wrap_parameters.rb
        new file:   config/locales/en.yml
        new file:   config/routes.rb
        new file:   config/secrets.yml
        new file:   db/seeds.rb
        new file:   lib/assets/.keep
        new file:   lib/tasks/.keep
        new file:   log/.keep
        new file:   public/404.html
        new file:   public/422.html
        new file:   public/500.html
        new file:   public/favicon.ico
        new file:   public/robots.txt
        new file:   vendor/assets/javascripts/.keep
        new file:   vendor/assets/stylesheets/.keep
</div></code></pre>
<p>### 4.2 Creating first commit
Now that all the files have been added we are ready to create out first commit. This commit will consist of all the files (or changes) that have been added. To create the commit run:</p>
<pre class="hljs"><code><div>git commit -m 'first commit'
</div></code></pre>
<p>The <code>-m</code> flag is the message to accompany the commit, the first one is very simple but generally the messages should be more descriptive like <code>Adding feature X and feature Y and fixing bug A</code></p>
<p>### 4.3 Adding remote repository
We have a commit created and ready to push to Github but we need to tell git where to send the commit. We need to add the remote repository we created previously on Github. If you look at the empty repo you will see the command we need to run in order to add the remote repository. Its highlighted here.</p>
<p><img src="screenshots/remote_repo.png" alt="New Repository"></p>
<p>Replace USERNAME with your own and run the following command from the <code>todo-app</code> root directory:</p>
<pre class="hljs"><code><div>git remote add origin git@github.com:USERNAME/todo-app.git
</div></code></pre>
<h3 id="pushing-to-github">Pushing to Github</h3>
<p>Now that everything is ready lets push the app to Github. Run the following command:</p>
<pre class="hljs"><code><div>git push -u origin master
</div></code></pre>
<p>You will see output like this:</p>
<pre class="hljs"><code><div>Enumerating objects: 62, done.
Counting objects: 100% (62/62), done.
Delta compression using up to 8 threads
Compressing objects: 100% (51/51), done.
Writing objects: 100% (62/62), 16.77 KiB | 858.00 KiB/s, done.
Total 62 (delta 2), reused 0 (delta 0)
remote: Resolving deltas: 100% (2/2), done.
To github.com:jonathanmeaney/todo-app.git
 * [new branch]      master -&gt; master
Branch 'master' set up to track remote branch 'master' from 'origin'.
</div></code></pre>
<p>The <code>-u origin</code> is the remote repository called origin. This was created when we ran the command above to add the remote. And <code>master</code> is the name of the branch to push.</p>
<p>If you go to Github and to your repository you will see that all the files have been pushed up.</p>
<p><img src="screenshots/updated_repo.png" alt="Updated Repository"></p>
<p>Now that Github is setup lets move onto creating our first resource in the app.</p>
<h2 id="5-generators">5 Generators</h2>
<blockquote>
<p>Rails comes with a number of scripts called generators that are designed to make your development life easier by creating everything that's necessary to start working on a particular task.</p>
</blockquote>
<table>
<tr><th>Generator</th><th>Description</th></tr>
<tr><th>controller</th><td>Generate a new controller along with any corresponding views and tests. The syntax of the command is the controller generator followed by the name for the controller, singular names usually and following that a list of views can be specified to generate along with the controller:
E.G. <b>bundle exec rails generate controller Post index show view</b>
</td></tr>
<tr><th>job</th><td>Generate a new Job class. Jobs are tasks that can be done in a background asynchronous process.</td></tr>
<tr><th>mailer</th><td>Generate a new mailer for sending emails.</td></tr>
<tr><th>migration</th><td>Generate a migration. A migration is some task that will be carried out on the database. For example, adding a new column to a table, creating a new table, adding an index etc. the syntax for the command is the migration generator followed by a name for the migration and afterwards a set of options or list of fields:
E.G. <b>bundle exec rails generate migration AddFieldToModel name:string age:integer</b>
</td></tr>
<tr><th>model</th><td>Generate a new model. This will create the model class file along with a migration to create the corresponding table in the database. The syntax is the model generator followed by a name for the model, singular names usually. A list of fields and types can also be specified following the pattern <b>field:type</b>.
E.G. <b>bundle exec rails generate model Person name:string email:string age:integer dob:date admin:boolean</b>
</td></tr>
<tr><th>scaffold</th><td>Generate a scaffold for a resource. This will generate a controller with typical CRUD actions, views, a model and a migration all in one go. Similar to the <b>model</b> generator you can specify a list of fields and types with this generator to populate the model with.
E.G. <b>bundle exec rails generate scaffold Person name:string email:string age:integer dob:date admin:boolean</b>
</td></tr>
</table>
<h2 id="6-create-the-homepage">6 Create the Homepage</h2>
<h2 id="61-creating-the-controller">6.1 Creating the controller</h2>
<p>First open the <code>Gemfile</code> there is something we need to remove. We don't use <code>CoffeeScript</code> (CoffeeScript is a language that compiles into JavaScript) but the gem gets included by default. To prevent Rails from generating <code>CoffeeScript</code> files we need to remove it from the <code>Gemfile</code>. Delete the lines:</p>
<pre class="hljs"><code><div># Use CoffeeScript for .coffee assets and views
gem 'coffee-rails', '~&gt; 4.1.0'
</div></code></pre>
<p>Now with <code>CoffeeScript</code> removed, we're going to use one of the generators from the table above.</p>
<p>The <code>controller</code> generator creates controllers and optionally views to accompany. We will create a controller for generate application pages that will be available to anyone without an account. We will call the controller <code>Site</code> and give it two views <code>index</code> and <code>about</code>. The generator command looks like so:</p>
<pre class="hljs"><code><div>bundle exec rails generate controller Site index about
</div></code></pre>
<p>You will see the following file creation output from running the command:</p>
<pre class="hljs"><code><div>create  app/controllers/site_controller.rb
  route  get 'site/about'
  route  get 'site/index'
invoke  erb
create    app/views/site
create    app/views/site/index.html.erb
create    app/views/site/about.html.erb
invoke  rspec
create    spec/controllers/site_controller_spec.rb
create    spec/views/site
create    spec/views/site/index.html.erb_spec.rb
create    spec/views/site/about.html.erb_spec.rb
invoke  helper
create    app/helpers/site_helper.rb
invoke    rspec
create      spec/helpers/site_helper_spec.rb
invoke  assets
invoke    js
create      app/assets/javascripts/site.js
invoke    scss
create      app/assets/stylesheets/site.scss
</div></code></pre>
<h3 id="62-updating-the-router">6.2 Updating the router</h3>
<p>The router is located in <code>config/routes.rb</code> and:</p>
<blockquote>
<p>The Rails router recognizes URLs and dispatches them to a controller's action, or to a Rack application. It can also generate paths and URLs, avoiding the need to hardcode strings in your views.</p>
</blockquote>
<p>You can read more about it in the <a href="https://guides.rubyonrails.org/routing.html">documentation</a></p>
<p>We need to make a few updates so that our new controller can be navigated to in the browser. The router lets you set a <code>root</code> path and this will be our <code>homepage</code>. The homepage will be the <code>index</code> view of the <code>Site</code> controller we just created.</p>
<p>The <code>root</code> method specifies which page should be matched to <code>/</code>. Update the <code>config/routes.rb</code> file like to add <code>Site index</code> as the root. Also removing the routes <code>get 'site/index'</code> and <code>get 'site/about'</code> that the generator automatically added. The updated routes will look like so.</p>
<pre class="hljs"><code><div>Rails.application.routes.draw <span class="hljs-keyword">do</span>
  root <span class="hljs-symbol">to:</span> <span class="hljs-string">"site#index"</span>
  get <span class="hljs-string">'about'</span>, <span class="hljs-symbol">to:</span> <span class="hljs-string">'site#about'</span>
  ...
  ...
  ...
</div></code></pre>
<p>Now start the server with:</p>
<pre class="hljs"><code><div>bundle exec rails server
</div></code></pre>
<p>And navigate to <code>http://localhost:3000</code> in the browser and you will see this beautiful page.</p>
<p><img src="screenshots/home_page.png" alt="Home Page"></p>
<h3 id="63-beautify-the-application">6.3 Beautify the application</h3>
<p>We're going to import <code>Bootstrap</code> to make things look a lot better.</p>
<blockquote>
<p>Bootstrap is the most popular HTML, CSS, and JS framework for developing responsive, mobile first projects on the web.</p>
</blockquote>
<p>The getting started documentation for <code>Bootstrap</code> is <a href="https://getbootstrap.com/docs/4.5/getting-started/introduction/">here</a> and all the different components that <code>Bootstrap</code> provides are <a href="https://getbootstrap.com/docs/4.5/components/alerts/">here</a>.</p>
<p>The <code>app/views/layouts/application.html.erb</code> file contains the general structure and layout of our application. It is here where the general navigation will go. When navigating to a new page Rails will inject the content of that page into <code>&lt;%= yield %&gt;</code> meaning we don't need to keep repeating elements such as the navigation bar on each page. We just add it in the layouts once.</p>
<p>Replace the contents of <code>app/views/layouts/application.html.erb</code> with the following. This will include the styling for <code>Bootstrap</code> and also give up a <a href="https://getbootstrap.com/docs/4.5/components/navbar/">navbar</a> at the top to navigate between pages.</p>
<pre class="hljs"><code><div><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>TodoApp<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Required meta tags --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"utf-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1, shrink-to-fit=no"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Latest compiled and minified CSS --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"</span> <span class="hljs-attr">integrity</span>=<span class="hljs-string">"sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2"</span> <span class="hljs-attr">crossorigin</span>=<span class="hljs-string">"anonymous"</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- Latest compiled and minified JavaScript --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://code.jquery.com/jquery-3.5.1.slim.min.js"</span> <span class="hljs-attr">integrity</span>=<span class="hljs-string">"sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"</span> <span class="hljs-attr">crossorigin</span>=<span class="hljs-string">"anonymous"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"</span> <span class="hljs-attr">integrity</span>=<span class="hljs-string">"sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"</span> <span class="hljs-attr">crossorigin</span>=<span class="hljs-string">"anonymous"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js"</span> <span class="hljs-attr">integrity</span>=<span class="hljs-string">"sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s"</span> <span class="hljs-attr">crossorigin</span>=<span class="hljs-string">"anonymous"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">%=</span> <span class="hljs-attr">stylesheet_link_tag</span>    '<span class="hljs-attr">application</span>', <span class="hljs-attr">media:</span> '<span class="hljs-attr">all</span>', '<span class="hljs-attr">data-turbolinks-track</span>' =&gt;</span> true %&gt;
    <span class="hljs-tag">&lt;<span class="hljs-name">%=</span> <span class="hljs-attr">javascript_include_tag</span> '<span class="hljs-attr">application</span>', '<span class="hljs-attr">data-turbolinks-track</span>' =&gt;</span> true %&gt;
    <span class="hljs-tag">&lt;<span class="hljs-name">%=</span> <span class="hljs-attr">csrf_meta_tags</span> %&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">nav</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar navbar-expand-md navbar-light bg-light"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar-brand"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>ToDo App<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar-toggler"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">data-toggle</span>=<span class="hljs-string">"collapse"</span> <span class="hljs-attr">data-target</span>=<span class="hljs-string">"#navbarsExampleDefault"</span> <span class="hljs-attr">aria-controls</span>=<span class="hljs-string">"navbarsExampleDefault"</span> <span class="hljs-attr">aria-expanded</span>=<span class="hljs-string">"false"</span> <span class="hljs-attr">aria-label</span>=<span class="hljs-string">"Toggle navigation"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar-toggler-icon"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"collapse navbar-collapse"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"navbarsExampleDefault"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar-nav mr-auto"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/"</span>&gt;</span>Home<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/about"</span>&gt;</span>About<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">%=</span> <span class="hljs-attr">yield</span> %&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-comment">&lt;!-- /.container --&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</div></code></pre>
<p>Refresh the browser and you should see the following.</p>
<p><img src="screenshots/bootstrap_home_page.png" alt="Bootstrapped Home Page"></p>
<h3 id="64-improve-the-homepage">6.4 Improve the homepage</h3>
<p>We're going to use the <a href="https://getbootstrap.com/docs/4.5/components/jumbotron/">jumbotron</a> component from <code>Bootstrap</code> to make the homepage look a bit nicer.</p>
<p>Replace the contents of <code>app/views/site/index.html.erb</code> with:</p>
<pre class="hljs"><code><div><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"jumbotron"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"display-4"</span>&gt;</span>Welcome!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"lead"</span>&gt;</span>Welcome to the ToDo App!<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">hr</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"my-4"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Its built using Ruby on Rails 4.2 and Bootstrap 4.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-primary btn-lg"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/about"</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"button"</span>&gt;</span>Learn more<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</div></code></pre>
<p>And if you refresh the page in the browser you will see this!</p>
<p><img src="screenshots/jumbotron.png" alt="Jumbotron"></p>
<p>Its looking more like an app now!</p>
<h3 id="push-up-the-new-controller-and-style-changes-to-github">Push up the new controller and style changes to Github</h3>
<ol>
<li>Run <code>git status</code> and see all the new files and updates that have been added.</li>
<li>Add everything again using <code>git add .</code> and then run <code>git status</code> again to see all the changes have been added.</li>
<li>Now create a new commit <code>git commit -m 'Adding Site controller and improving style'</code></li>
<li>Push with <code>git push -u origin master</code></li>
</ol>
<h2 id="7-create-the-user">7 Create the User</h2>
<h3 id="71-create-a-new-branch-for-adding-user">7.1 Create a new branch for adding User</h3>
<p>Lets start using branches for new features and work. We are already up to date with master so we can create a new branch on which to add <code>User</code>. Its always a good idea to check if there are any uncommitted changes before changing branches or creating a new one. Run:</p>
<pre class="hljs"><code><div>git status
</div></code></pre>
<p>and you will see something like this:</p>
<pre class="hljs"><code><div>On branch master
Your branch is up to date with 'origin/master'.

nothing to commit, working tree clean
</div></code></pre>
<p>This means there are no changes made so we can change branches or create a new one without any issue. The easiest way to create a new branch and to check it out is with the following command <code>git checkout -b &lt;branch-name&gt;</code>. Lets use it to create a branch for users:</p>
<pre class="hljs"><code><div>git checkout -b adding-users
</div></code></pre>
<p>The <code>adding-users</code> branch has been created, you can also run <code>git status</code> to verify the branch you are one. Running it now will show:</p>
<pre class="hljs"><code><div>On branch adding-users
nothing to commit, working tree clean
</div></code></pre>
<h3 id="72-generating-the-user-model">7.2 Generating the User model</h3>
<p>We are going to use the model generator to create the <code>User</code> model. A user will have 2 attributes <code>email</code> and <code>password</code>. The password however will be saved as <code>password_digest</code> in the database. The password will be encrypted. Run the following command to generate the <code>User</code> model. <code>email</code> and <code>password_digest</code> are the table fields, usually you would specify what the field type is too e.g. <code>age:integer dob:date</code> but if you don't specify the type it will default to <code>string</code>.</p>
<pre class="hljs"><code><div>bundle exec rails generate model User email password_digest
</div></code></pre>
<p>You should see the following output from the command. You can see the <code>migration</code> file being generated in the <code>db/migrate</code> directory. The migration file will contain code to generate the <code>users</code> table in the database with the <code>email</code> and <code>password_digest</code> fields along with some timestamp fields. Rails adds an auto incrementing <code>id</code> field too. The model class gets created and also since we have RSpec installed a test file for the model is also generated.</p>
<pre class="hljs"><code><div>invoke  active_record
create    db/migrate/20201028134028_create_users.rb
create    app/models/user.rb
invoke    rspec
create      spec/models/user_spec.rb
</div></code></pre>
<p>Now the model is created along with the migration to update the database we need to run a rake task to run the migration. Running:</p>
<pre class="hljs"><code><div>bundle exec rake db:migrate
</div></code></pre>
<p>will run any outstanding migrations that have not been run yet (Rails keeps track of which migrations have been run using the <code>schema_migrations</code> table that it automatically creates for us). You should see some output like the following from the migration:</p>
<pre class="hljs"><code><div>== 20201028134028 CreateUsers: migrating ======================================
-- create_table(:users)
   -&gt; 0.0547s
== 20201028134028 CreateUsers: migrated (0.0548s) ====================
</div></code></pre>
<p>This means that the table has been created in the database. If you view the database now you will see the tablas has been created along with the <code>schema_migrations</code> table discussed above.</p>
<p><img src="screenshots/rdbms_users.png" alt="RDBMS"></p>
<h3 id="73-adding-bcrypt-gem-for-encrypting-password">7.3 Adding bcrypt gem for encrypting password</h3>
<blockquote>
<p>bcrypt() is a sophisticated and secure hash algorithm designed by The OpenBSD project for hashing passwords. The bcrypt Ruby gem provides a simple wrapper for safely handling passwords.</p>
</blockquote>
<p>We're going to use this gem for encrypting passwords. Open the <code>Gemfile</code> and add <code>gem 'bcrypt', '3.1.16'</code> to it, I put it under the <code>sdoc</code> gem. After adding this to the <code>Gemfile</code> we need to get bundler to install the gem for us. Running:</p>
<pre class="hljs"><code><div>bundle install
</div></code></pre>
<p>will install the gem for us to use in the application.</p>
<p>When that is done open <code>app/models/user.rb</code>. Rails has an in build feature to handle encrypting passwords. We need to add <code>has_secure_password</code> to the <code>User</code> model.</p>
<blockquote>
<p>has_secure_password Adds methods to set and authenticate against a BCrypt password</p>
</blockquote>
<p>more info can be found in the <a href="https://api.rubyonrails.org/classes/ActiveModel/SecurePassword/ClassMethods.html#method-i-has_secure_password">documentation</a></p>
<p>After updating the <code>user.rb</code> it should look like this:</p>
<pre class="hljs"><code><div><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> &lt; ActiveRecord::Base</span>
  has_secure_password
<span class="hljs-keyword">end</span>
</div></code></pre>
<p>Now our user model will have the ability to work with passwords and encrypting.</p>
<h3 id="74-generating-the-users-controller">7.4 Generating the Users controller</h3>
<p>Now the <code>User</code> model is in place we need to create a <code>controller</code> to interact with the model and allow us to create new users. Using the <code>controller</code> generator generate a controller with <code>new</code> and <code>create</code> views and actions.</p>
<pre class="hljs"><code><div>bundle exec rails generate controller Users new create
</div></code></pre>
<p>The output of the command looks like this, creating all the different files.</p>
<pre class="hljs"><code><div>create  app/controllers/users_controller.rb
  route  get 'users/create'
  route  get 'users/new'
invoke  erb
create    app/views/users
create    app/views/users/new.html.erb
create    app/views/users/create.html.erb
invoke  rspec
create    spec/controllers/users_controller_spec.rb
create    spec/views/users
create    spec/views/users/new.html.erb_spec.rb
create    spec/views/users/create.html.erb_spec.rb
invoke  helper
create    app/helpers/users_helper.rb
invoke    rspec
create      spec/helpers/users_helper_spec.rb
invoke  assets
invoke    js
create      app/assets/javascripts/users.js
invoke    scss
create      app/assets/stylesheets/users.scss
</div></code></pre>
<h3 id="75-update-routes-for-user-controller">7.5 Update routes for User controller</h3>
<p>The router has a method <code>resources</code> which will auto generate routes for a controller. We're going to use it for <code>users</code>. The method can also take several options including the <code>only</code> array. This is an array of actions to generate routes for. We only have <code>new</code> and <code>create</code> actions defined in the <code>UsersController</code> so we should only generate routes for those. Update the <code>config/routes.rb</code> with the new <code>resources</code> line for users. The code is below.</p>
<pre class="hljs"><code><div>Rails.application.routes.draw <span class="hljs-keyword">do</span>
  root <span class="hljs-symbol">to:</span> <span class="hljs-string">"site#index"</span>
  get <span class="hljs-string">'about'</span>, <span class="hljs-symbol">to:</span> <span class="hljs-string">'site#about'</span>
  resources <span class="hljs-symbol">:users</span>, <span class="hljs-symbol">only:</span> [<span class="hljs-symbol">:new</span>, <span class="hljs-symbol">:create</span>]
  ...
  ...
  ...
</div></code></pre>
<p>Another handy rake task is <code>routes</code> this will print out all the routes currently defined and where they route to. Its very useful. If you run:</p>
<pre class="hljs"><code><div>bundle exec rake routes
</div></code></pre>
<p>You'll get output like the following which lists all the defined routes along with the http verb used to access it. It also details which controller and action the route will go to.</p>
<pre class="hljs"><code><div>  Prefix Verb URI Pattern          Controller#Action
    root GET  /                    site#index
   about GET  /about(.:format)     site#about
   users POST /users(.:format)     users#create
new_user GET  /users/new(.:format) users#new
</div></code></pre>
<h3 id="76-adding-link-to-signup">7.6 Adding link to signup</h3>
<p>We need to make an update to the UI to provide a link to the new user page. We're going to use one of the Rails view helper methods called <code>link_to</code> to generate the link. Rails has many view methods but you can find out more about <code>link_to</code> <a href="https://apidock.com/rails/v5.2.3/ActionView/Helpers/UrlHelper/link_to">here</a>.</p>
<p>Open the <code>app/views/layouts/application.html.erb</code> and we will modify the <code>ul</code> inside the navbar. These links are the navigation for the application. We're going to replace these HTML links with the <code>link_to</code> rails helper method.</p>
<pre class="hljs"><code><div><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/"</span>&gt;</span>Home<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
becomes
<span class="hljs-tag">&lt;<span class="hljs-name">%=</span> <span class="hljs-attr">link_to</span> '<span class="hljs-attr">Home</span>', <span class="hljs-attr">root_path</span>, <span class="hljs-attr">class:</span> '<span class="hljs-attr">nav-link</span>' %&gt;</span>
</div></code></pre>
<p>and</p>
<pre class="hljs"><code><div><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/about"</span>&gt;</span>About<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
becomes
<span class="hljs-tag">&lt;<span class="hljs-name">%=</span> <span class="hljs-attr">link_to</span> '<span class="hljs-attr">About</span>', <span class="hljs-attr">about_path</span>, <span class="hljs-attr">class:</span> '<span class="hljs-attr">nav-link</span>' %&gt;</span>
</div></code></pre>
<p>we will also add a new link to get to the register page.</p>
<pre class="hljs"><code><div><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">%=</span> <span class="hljs-attr">link_to</span> '<span class="hljs-attr">Register</span>', <span class="hljs-attr">new_user_path</span>, <span class="hljs-attr">class:</span> '<span class="hljs-attr">nav-link</span>' %&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
</div></code></pre>
<p>Together the final changes will look like this:</p>
<pre class="hljs"><code><div><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar-nav mr-auto"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> link_to <span class="hljs-string">'Home'</span>, root_path, <span class="hljs-class"><span class="hljs-keyword">class</span>: '<span class="hljs-title">nav</span>-<span class="hljs-title">link</span>' </span></span><span class="xml"><span class="hljs-tag">%&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> link_to <span class="hljs-string">'About'</span>, about_path, <span class="hljs-class"><span class="hljs-keyword">class</span>: '<span class="hljs-title">nav</span>-<span class="hljs-title">link</span>' </span></span><span class="xml"><span class="hljs-tag">%&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> link_to <span class="hljs-string">'Register'</span>, new_user_path, <span class="hljs-class"><span class="hljs-keyword">class</span>: '<span class="hljs-title">nav</span>-<span class="hljs-title">link</span>' </span></span><span class="xml"><span class="hljs-tag">%&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
</span></div></code></pre>
<p>In the <code>link_to</code> method the first parameter is the text to display in the rendered link in the HTML.</p>
<p>The second parameter is the URL for the link. Notice that the URL matches the prefix of the routes printed above when running <code>bundle exec rake routes</code>. Rails auto generates methods for each of these route prefixes and appending <code>_path</code> just returns the path for that particular route. So <code>home_path</code> would return <code>/</code> and <code>about_path</code> would return <code>/about</code> and <code>new_user_path</code> would return <code>/users/new</code>.</p>
<p>The last parameter of the <code>link_to</code> are just an additional HTML options needed, classes, id anything like that. We're keeping the class needed for Bootstrap to apply styles.</p>
<p>Refresh the browser page and you should see the new link added to the navigation menu and clicking it will bring you to the <code>app/views/users/new.html.erb</code> page.</p>
<p><img src="screenshots/register_link.png" alt="Register link"></p>
<h3 id="77-creating-signup-form">7.7 Creating signup form</h3>
<p>Open up <code>app/views/users/new.html.erb</code>, we're going to update it to include a form for registering as a new user using some of the Rails form helper methods and Bootstrap again. Replace the contents of the file with the following code:</p>
<pre class="hljs"><code><div><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Register<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Enter your details below to register!<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> form_for @user <span class="hljs-keyword">do</span> <span class="hljs-params">|f|</span></span><span class="xml"><span class="hljs-tag">%&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> f.label <span class="hljs-symbol">:email</span></span><span class="xml"><span class="hljs-tag">%&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> f.email_field <span class="hljs-symbol">:email</span>, <span class="hljs-class"><span class="hljs-keyword">class</span>: '<span class="hljs-title">form</span>-<span class="hljs-title">control</span>'</span></span><span class="xml"><span class="hljs-tag">%&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> f.label <span class="hljs-symbol">:password</span></span><span class="xml"><span class="hljs-tag">%&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> f.password_field <span class="hljs-symbol">:password</span>, <span class="hljs-class"><span class="hljs-keyword">class</span>: '<span class="hljs-title">form</span>-<span class="hljs-title">control</span>'</span></span><span class="xml"><span class="hljs-tag">%&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-primary btn-block"</span>&gt;</span>Register<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">%</span></span></span><span class="ruby"> <span class="hljs-keyword">end</span> </span><span class="xml"><span class="hljs-tag">%&gt;</span>
</span></div></code></pre>
<p>This form is using the <code>form_for</code> helper. You can learn more about form helpers <a href="https://guides.rubyonrails.org/v4.2/form_helpers.html">here</a>.</p>
<p>The <code>form_for</code> helper will generate a HTML form tag and populate its action appropriately. We've specified here the form is for a <code>@user</code> object. The helper method will use this to determine what the action of the form should be.</p>
<p>We are also using the <code>email_field</code> helper and the <code>password_field</code> helper to generate the input fields for email and password. Input helpers need the name of the attribute they are representing, the user <code>:email</code> and <code>:password</code> in this instance.</p>
<p>The above code will generate the following HTML if you inspect the browser page.</p>
<pre class="hljs"><code><div><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"new_user"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"new_user"</span> <span class="hljs-attr">action</span>=<span class="hljs-string">"/users"</span> <span class="hljs-attr">accept-charset</span>=<span class="hljs-string">"UTF-8"</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"post"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"utf8"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"hidden"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"✓"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"hidden"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"authenticity_token"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"jCYJesIMUoRawylhzQiqaPRADGwbhyqQxq2LNPVfZQfNBF+6V8wIrLwXcKe166uUD1xprMZ3cgtspLaoffaF4g=="</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"user_email"</span>&gt;</span>Email<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"email"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"user[email]"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"user_email"</span> <span class="hljs-attr">autocomplete</span>=<span class="hljs-string">"off"</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"user_password"</span>&gt;</span>Password<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"user[password]"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"user_password"</span> <span class="hljs-attr">autocomplete</span>=<span class="hljs-string">"off"</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-primary btn-block"</span>&gt;</span>Register<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
</div></code></pre>
<p>If you refresh the browser after making this change adding the form you will see this error:</p>
<p><img src="screenshots/new_user_error.png" alt="New User Error"></p>
<p>We're created a form for a new user object but we haven't actually created that user object yet. To fix this open <code>app/controllers/users_controller.rb</code>. We're going to make a change to the <code>new</code> action. This action corresponds with the <code>app/views/users/new.html.erb</code> view, any instance variables (variables starting with @) declared in this method will be accessible from the corresponding view. So in the <code>new</code> action declare a <code>@user</code> object to be a new instance of the <code>User</code> model. The code will look like this:</p>
<pre class="hljs"><code><div><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UsersController</span> &lt; ApplicationController</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">new</span></span>
    @user = User.new
  <span class="hljs-keyword">end</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create</span></span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</div></code></pre>
<p>Now if you refresh the browser the error will be resolved and you will see the form.</p>
<p><img src="screenshots/new_user_form.png" alt="New User Form"></p>
<h3 id="78-creating-a-new-user">7.8 Creating a new user</h3>
<p>The form is in place when we submit it won't create a new user. That functionality needs to be added now. If we have another look at the routes by running <code>bundle exec rake routes</code></p>
<pre class="hljs"><code><div>  Prefix Verb URI Pattern          Controller#Action
    root GET  /                    site#index
   about GET  /about(.:format)     site#about
   users POST /users(.:format)     users#create
new_user GET  /users/new(.:format) users#new
</div></code></pre>
<p>we can see that using the <code>POST</code> verb to <code>/users</code> will route to the <code>create</code> action in the <code>users</code> controller. So we need to prepare that action to receive the data from the form and then use it to create a new <code>User</code> record in the database.</p>
<p>Open <code>app/controllers/users_controller.rb</code>. We will make a few changes. Data coming from the form will be in a <code>params</code> hash object that rails provides. So we can retrieve the values from the <code>params</code>. But retrieving them directly from the <code>param</code> isn't a good idea because anything can be in there. Theres a way to ensure that only the correct parameters are allowed.</p>
<p>We're going to add a private method called <code>user_params</code>. This will use <code>Strong Parameters</code> which is a way of encapsulating permissible parameters. It will prevent other data being injected into the payload and making its way into the app. You can read more about strong parameters in the <a href="https://edgeapi.rubyonrails.org/classes/ActionController/StrongParameters.html">documentation</a></p>
<p>Im the <code>user_params</code> method we specify that the params requires a <code>user</code> object and we also specify the fields that are permissable. The <code>user_params</code> method will look like this.</p>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">user_params</span></span>
  params.<span class="hljs-keyword">require</span>(<span class="hljs-symbol">:user</span>).permit(<span class="hljs-symbol">:email</span>, <span class="hljs-symbol">:password</span>)
<span class="hljs-keyword">end</span>
</div></code></pre>
<p>This is a pattern you should use for all data coming from forms in  controllers.</p>
<p>Now that the <code>user_params</code> method is in place lets use it. Inside the <code>create</code> action we will use the <code>ActiveRecord</code> <code>create</code> method which is available to models. This will accept a hash of field params and create a new object with the params and save it to the database. After the user is created and saved we then store the <code>id</code> of the the user in the <code>session</code> this will be used to keep track of authentication status.</p>
<p>This is how the create method looks after these changes.</p>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create</span></span>
  @user = User.create(user_params)
  session[<span class="hljs-symbol">:user_id</span>] = @user.id
<span class="hljs-keyword">end</span>
</div></code></pre>
<p>The whole controller should look like this when all these changes have been made to support creating a new user.</p>
<pre class="hljs"><code><div><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UsersController</span> &lt; ApplicationController</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">new</span></span>
    @user = User.new
  <span class="hljs-keyword">end</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create</span></span>
    @user = User.create(user_params)
    session[<span class="hljs-symbol">:user_id</span>] = @user.id
  <span class="hljs-keyword">end</span>

  private

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">user_params</span></span>
    params.<span class="hljs-keyword">require</span>(<span class="hljs-symbol">:user</span>).permit(<span class="hljs-symbol">:email</span>, <span class="hljs-symbol">:password</span>)
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</div></code></pre>
<p>Now return to the new user form in the browser, fill it in and submit. The screen wont show much at this point but if you inspect the database you will see the new user record with has been created.</p>
<p><img src="screenshots/new_user_success.png" alt="New User Record"></p>
<h3 id="79-pushing-new-branch-and-changes-to-github">7.9 Pushing new branch and changes to github</h3>
<p>Its time to push up the users feature and create a pull request. Running <code>git status</code> will show all the changes so far. Files modified and added.</p>
<pre class="hljs"><code><div>On branch adding-users
Changes not staged for commit:
  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)
  (use &quot;git checkout -- &lt;file&gt;...&quot; to discard changes in working directory)

        modified:   Gemfile
        modified:   Gemfile.lock
        modified:   app/views/layouts/application.html.erb
        modified:   config/routes.rb

Untracked files:
  (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)

        app/assets/javascripts/users.js
        app/assets/stylesheets/users.scss
        app/controllers/users_controller.rb
        app/helpers/users_helper.rb
        app/models/user.rb
        app/views/users/
        db/migrate/
        db/schema.rb
        spec/controllers/users_controller_spec.rb
        spec/helpers/users_helper_spec.rb
        spec/models/
        spec/views/user/
        spec/views/users/
</div></code></pre>
<p>Again we will add all of these changes with <code>git add .</code> and then running <code>git status</code> again will show:</p>
<pre class="hljs"><code><div>On branch adding-users
Changes to be committed:
  (use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)

        modified:   Gemfile
        modified:   Gemfile.lock
        new file:   app/assets/javascripts/users.js
        new file:   app/assets/stylesheets/users.scss
        new file:   app/controllers/users_controller.rb
        new file:   app/helpers/users_helper.rb
        new file:   app/models/user.rb
        modified:   app/views/layouts/application.html.erb
        new file:   app/views/users/create.html.erb
        new file:   app/views/users/new.html.erb
        modified:   config/routes.rb
        new file:   db/migrate/20201028134028_create_users.rb
        new file:   db/schema.rb
        new file:   spec/controllers/users_controller_spec.rb
        new file:   spec/helpers/users_helper_spec.rb
        new file:   spec/models/user_spec.rb
        new file:   spec/views/user/create.html.erb_spec.rb
        new file:   spec/views/user/new.html.erb_spec.rb
        new file:   spec/views/users/create.html.erb_spec.rb
        new file:   spec/views/users/new.html.erb_spec.rb
</div></code></pre>
<p>Now all the changes are added lets create a commit with <code>git commit -m 'Adding users feature with registration.'</code> and then we need to push. Since we are on the <code>adding-users</code> branch we need to push to that one on Github and not <code>master</code>. So the command to push will be:</p>
<pre class="hljs"><code><div>git push -u origin adding-users
</div></code></pre>
<p>And you should see the following output, including a section where the new branch gets created in the remote repository.</p>
<pre class="hljs"><code><div>Enumerating objects: 61, done.
Counting objects: 100% (61/61), done.
Delta compression using up to 8 threads
Compressing objects: 100% (38/38), done.
Writing objects: 100% (41/41), 4.77 KiB | 542.00 KiB/s, done.
Total 41 (delta 10), reused 0 (delta 0)
remote: Resolving deltas: 100% (10/10), completed with 7 local objects.
remote:
remote: Create a pull request for 'adding-users' on GitHub by visiting:
remote:      https://github.com/jonathanmeaney/todo-app/pull/new/adding-users
remote:
To github.com:jonathanmeaney/todo-app.git
 * [new branch]      adding-users -&gt; adding-users
Branch 'adding-users' set up to track remote branch 'adding-users' from 'origin'.
</div></code></pre>
<h3 id="710-opening-a-pull-request">7.10 Opening a pull request</h3>
<p>On Github click on the <code>New pull request</code> button. The branch on the left is the branch we want to merge change into and the branch on the right has the changes we want to merge. Pick <code>master</code> as the branch on the left and <code>adding-users</code> as the branch on the right.</p>
<p><img src="screenshots/opening_a_new_pull_request.png" alt="Opening a new PR">
Give your pull request a title and description, assign it to yourself on the right. If you require any reviewers you can add them here too. Click on <code>Create pull request</code>. This will create your pull request.
<img src="screenshots/new_pr_for_user.png" alt="New users PR"></p>
<p>Clicking on the <code>Files changed</code> tab will show all the changes included in the pull request.
<img src="screenshots/new_pr_for_user_changes.png" alt="New users PR"></p>
<p>This pull request doesn't require a review from other developers so for now you can merge it so open the pull request and click on the <code>merge</code> button.
<img src="screenshots/merged_pr.png" alt="Merged PR"></p>
<p>Now that the pull request has been merged to <code>master</code> we need to switch branches to <code>master</code> locally and pull down the latest changes.</p>
<p>From the root of the <code>todo-app</code> run <code>git status</code> to make sure you have no outstanding changes that need committing. If all is clear then change branches to <code>master</code> with:</p>
<pre class="hljs"><code><div>git checkout master
</div></code></pre>
<p>You will see this output in the terminal:</p>
<pre class="hljs"><code><div>Switched to branch 'master'
Your branch is behind 'origin/master' by 2 commits, and can be fast-forwarded.
  (use &quot;git pull&quot; to update your local branch)
</div></code></pre>
<p>This means that the version of <code>master</code> on your machine is behind that on the remote repository and the new changes need to be pulled to keep in sync. Running <code>git pull</code> will pull all the new changes form the remote version of <code>master</code>. You will see this in the terminal, all the files that we merged from the <code>adding-users</code> branch are now on <code>master</code>:</p>
<pre class="hljs"><code><div>Updating a8458c5..b510d36
Fast-forward
 Gemfile                                   |  3 +--
 Gemfile.lock                              |  2 ++
 app/assets/javascripts/users.js           |  2 ++
 app/assets/stylesheets/users.scss         |  3 +++
 app/controllers/users_controller.rb       | 16 ++++++++++++++++
 app/helpers/users_helper.rb               |  2 ++
 app/models/user.rb                        |  3 +++
 app/views/layouts/application.html.erb    |  7 +++++--
 app/views/users/create.html.erb           |  2 ++
 app/views/users/new.html.erb              | 14 ++++++++++++++
 config/routes.rb                          |  2 +-
 db/migrate/20201028134028_create_users.rb | 10 ++++++++++
 db/schema.rb                              | 23 +++++++++++++++++++++++
 spec/controllers/users_controller_spec.rb | 19 +++++++++++++++++++
 spec/helpers/users_helper_spec.rb         | 15 +++++++++++++++
 spec/models/user_spec.rb                  |  5 +++++
 spec/views/user/create.html.erb_spec.rb   |  5 +++++
 spec/views/user/new.html.erb_spec.rb      |  5 +++++
 spec/views/users/create.html.erb_spec.rb  |  5 +++++
 spec/views/users/new.html.erb_spec.rb     |  5 +++++
 20 files changed, 143 insertions(+), 5 deletions(-)
 create mode 100644 app/assets/javascripts/users.js
 create mode 100644 app/assets/stylesheets/users.scss
 create mode 100644 app/controllers/users_controller.rb
 create mode 100644 app/helpers/users_helper.rb
 create mode 100644 app/models/user.rb
 create mode 100644 app/views/users/create.html.erb
 create mode 100644 app/views/users/new.html.erb
 create mode 100644 db/migrate/20201028134028_create_users.rb
 create mode 100644 db/schema.rb
 create mode 100644 spec/controllers/users_controller_spec.rb
 create mode 100644 spec/helpers/users_helper_spec.rb
 create mode 100644 spec/models/user_spec.rb
 create mode 100644 spec/views/user/create.html.erb_spec.rb
 create mode 100644 spec/views/user/new.html.erb_spec.rb
 create mode 100644 spec/views/users/create.html.erb_spec.rb
 create mode 100644 spec/views/users/new.html.erb_spec.rb
</div></code></pre>
<h2 id="8-user-login">8 User Login</h2>
<p>Now we can create users we need a way for them to be able to login. In order to handle user authentication we will add another controller to do this. The <code>Sessions</code> controller. The user will be able to login and logout using this controller.</p>
<h3 id="81-create-new-branch-for-user-login-work">8.1 Create new branch for user login work</h3>
<p>First create a new branch that all this user login work will go onto. Run <code>git status</code> to make sure you have no uncommitted files and then create a new branch with:</p>
<pre class="hljs"><code><div>git checkout -b adding-user-login
</div></code></pre>
<h3 id="82-creating-sessions-controller">8.2 Creating Sessions controller</h3>
<p>Now we're on the new branch use the <code>generate</code> generator to create a new controller called <code>Sessions</code> with <code>new</code>, <code>create</code> and <code>welcome</code> actions.</p>
<pre class="hljs"><code><div>bundle exec rails generate controller Sessions new create welcome
</div></code></pre>
<p>You will see the following output creating the controller and the associated views and other pieces.</p>
<pre class="hljs"><code><div>create  app/controllers/sessions_controller.rb
  route  get 'sessions/welcome'
  route  get 'sessions/create'
  route  get 'sessions/new'
invoke  erb
create    app/views/sessions
create    app/views/sessions/new.html.erb
create    app/views/sessions/create.html.erb
create    app/views/sessions/welcome.html.erb
invoke  rspec
create    spec/controllers/sessions_controller_spec.rb
create    spec/views/sessions
create    spec/views/sessions/new.html.erb_spec.rb
create    spec/views/sessions/create.html.erb_spec.rb
create    spec/views/sessions/welcome.html.erb_spec.rb
invoke  helper
create    app/helpers/sessions_helper.rb
invoke    rspec
create      spec/helpers/sessions_helper_spec.rb
invoke  assets
invoke    js
create      app/assets/javascripts/sessions.js
invoke    scss
create      app/assets/stylesheets/sessions.scss
</div></code></pre>
<p>We also need to update the routes to make sure the views for our new controller can be reached. Open <code>config/routes.rb</code> and replace the routes that the generator added with:</p>
<pre class="hljs"><code><div>get <span class="hljs-string">'login'</span>, <span class="hljs-symbol">to:</span> <span class="hljs-string">'sessions#new'</span>
post <span class="hljs-string">'login'</span>, <span class="hljs-symbol">to:</span> <span class="hljs-string">'sessions#create'</span>
get <span class="hljs-string">'welcome'</span>, <span class="hljs-symbol">to:</span> <span class="hljs-string">'sessions#welcome'</span>
</div></code></pre>
<p>We have a <code>get</code> and a <code>post</code> for <code>login</code> each going to a different action. We also have a <code>get</code> for welcome which will be a page you see after successfully logging in.</p>
<p>After making the changes the <code>config/routes.rb</code> file will look like this, I added a few additional comments:</p>
<pre class="hljs"><code><div>Rails.application.routes.draw <span class="hljs-keyword">do</span>
  <span class="hljs-comment"># home page</span>
  root <span class="hljs-symbol">to:</span> <span class="hljs-string">"site#index"</span>
  <span class="hljs-comment"># about page</span>
  get <span class="hljs-string">'about'</span>, <span class="hljs-symbol">to:</span> <span class="hljs-string">'site#about'</span>

  <span class="hljs-comment"># users</span>
  resources <span class="hljs-symbol">:users</span>, <span class="hljs-symbol">only:</span> [<span class="hljs-symbol">:new</span>, <span class="hljs-symbol">:create</span>]

  <span class="hljs-comment">#sessions</span>
  get <span class="hljs-string">'login'</span>, <span class="hljs-symbol">to:</span> <span class="hljs-string">'sessions#new'</span>
  post <span class="hljs-string">'login'</span>, <span class="hljs-symbol">to:</span> <span class="hljs-string">'sessions#create'</span>
  get <span class="hljs-string">'welcome'</span>, <span class="hljs-symbol">to:</span> <span class="hljs-string">'sessions#welcome'</span>
  ...
  ...
  ...
</div></code></pre>
<p>Next open <code>app/views/layouts/application.html.erb</code>. We will add a link to the login form. Add a new link to the navigation which will use the <code>login_path</code>. The <code>login_path</code> corresponds to the <code>get</code> <code>login</code> from the routes which will route to the <code>new</code> action in the <code>SessionsController</code>.</p>
<pre class="hljs"><code><div><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> link_to <span class="hljs-string">'Login'</span>, login_path, <span class="hljs-class"><span class="hljs-keyword">class</span>: '<span class="hljs-title">nav</span>-<span class="hljs-title">link</span>' </span></span><span class="xml"><span class="hljs-tag">%&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
</span></div></code></pre>
<p>Refresh the browser and you will see the new link to <code>Login</code>.
<img src="screenshots/login_link.png" alt="Login Link">
Clicking on the link will bring you to the <code>app/views/sessions/new.html.erb</code> page. Its a functionless page at the moment.
<img src="screenshots/login_page.png" alt="Login Page"></p>
<h3 id="83-create-login-form">8.3 Create login form</h3>
<p>Open <code>app/views/sessions/new.html.erb</code> we need to update the page to have a form for the user to enter their login details. The form is going to be very similar to the one we created for user registration. We're using the <code>form_tag</code> instead of <code>form_for</code> here since we aren't creating a new record. With <code>form_tag</code> you need to specify the action yourself. We're going to submit the data to the <code>/login</code> endpoint. Posting to this endpoint will route to the <code>SessionsController</code> <code>create</code> action.</p>
<p>Since we're using <code>form_tag</code> we're using different input method generators <code>email_field_tag</code> and <code>password_field_tag</code>, they function a bit different to the input generators we used preciously, they need to have a value specified, we don't have a value so its default is <code>''</code>.</p>
<pre class="hljs"><code><div><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Login<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Enter your details below to login!<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> form_tag <span class="hljs-string">'/login'</span> <span class="hljs-keyword">do</span> </span><span class="xml"><span class="hljs-tag">%&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> label_tag <span class="hljs-symbol">:email</span></span><span class="xml"><span class="hljs-tag">%&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> email_field_tag <span class="hljs-symbol">:email</span>, <span class="hljs-string">''</span>, <span class="hljs-class"><span class="hljs-keyword">class</span>: '<span class="hljs-title">form</span>-<span class="hljs-title">control</span>'</span></span><span class="xml"><span class="hljs-tag">%&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> label_tag <span class="hljs-symbol">:password</span></span><span class="xml"><span class="hljs-tag">%&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> password_field_tag <span class="hljs-symbol">:password</span>, <span class="hljs-string">''</span>, <span class="hljs-class"><span class="hljs-keyword">class</span>: '<span class="hljs-title">form</span>-<span class="hljs-title">control</span>'</span></span><span class="xml"><span class="hljs-tag">%&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-primary btn-block"</span>&gt;</span>Login<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">%</span></span></span><span class="ruby"> <span class="hljs-keyword">end</span> </span><span class="xml"><span class="hljs-tag">%&gt;</span>
</span></div></code></pre>
<p>Refresh the login page and you will see the login form!
<img src="screenshots/login_form.png" alt="Login Form"></p>
<h3 id="84-logging-in">8.4 Logging in</h3>
<p>The form we created for login will submit its data to the <code>SessionsController</code> <code>create</code> action. So we need to add some code to the action to handle the login process. There are a few steps.</p>
<ol>
<li>Use the model <code>find_by</code>finder method to find a user record that matches the email submitted in the form. You can learn more about finder methods <a href="https://api.rubyonrails.org/classes/ActiveRecord/FinderMethods.html">here</a></li>
<li>If there is a matching user object them use the <code>authenticate</code> method which will match the supplied password with the encrypted one.</li>
<li>If the password matches use the Rails method <code>redirect_to</code> to redirect to the <code>welcome</code> page.</li>
<li>If the password doesn't match or there is no matching user record redirect to the <code>login</code> page.</li>
</ol>
<p>Those steps are recreated below in the <code>create</code> action of the <code>SessionsController</code> so open <code>app/controllers/sessions_controller.rb</code> and edit the <code>create</code> action to look like so.</p>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create</span></span>
  <span class="hljs-comment"># find the user record that matches the email.</span>
  @user = User.find_by(<span class="hljs-symbol">email:</span> params[<span class="hljs-symbol">:email</span>])

  <span class="hljs-comment"># if the user record exists and the password matches.</span>
  <span class="hljs-comment"># Use the authenticate method provided with has_secure_password.</span>
  <span class="hljs-keyword">if</span> @user &amp;&amp; @user.authenticate(params[<span class="hljs-symbol">:password</span>])
    <span class="hljs-comment"># add the user_id to the session</span>
    session[<span class="hljs-symbol">:user_id</span>] = @user.id
    <span class="hljs-comment"># redirect to the welcome page.</span>
    redirect_to <span class="hljs-string">'/welcome'</span>
  <span class="hljs-keyword">else</span>
    <span class="hljs-comment"># if the email and password do not match redirect to the login page.</span>
    redirect_to <span class="hljs-string">'/login'</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</div></code></pre>
<p>Now attempt to login using the email and password you used to previously register. if successful you will be redirected to the <code>welcome</code> page. Its a boring page right now.
<img src="screenshots/login_welcome.png" alt="Welcome page">
Open up <code>app/views/sessions/welcome.html.erb</code> and update the HTML to be a bit better. Replace the code with:</p>
<pre class="hljs"><code><div><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Welcome<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>You have successfully logged in!<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
</div></code></pre>
<p>Refresh the page and you will see a slightly better page.
<img src="screenshots/login_welcome_better.png" alt="Welcome page"></p>
<h3 id="85-checking-logged-in-status">8.5 Checking logged in status</h3>
<p>Its really handy to be able to tell if someone is logged in and not only that but who is actually logged in. So we will add a few methods to provide the functionality.</p>
<p>Open the <code>app/controllers/application_controller.rb</code>. We are going to add some helper methods that will be available in all controllers and views, since all controllers in the app naturally inherit from the <code>ApplicationController</code>.</p>
<p>We will add two methods to <code>app/controllers/application_controller.rb</code>, <code>current_user</code> which will return the user object for the logged in user and another method to check if anyone is logged in called <code>logged_in?</code>. Methods with <code>?</code> at the end should return a boolean value. We will use the Rails <code>helper_method</code> method to declare these methods as helpers, which will mean they can be accessed from views as well as controllers.</p>
<p>Update the code in <code>app/controllers/application_controller.rb</code> to include the new helper methods.</p>
<pre class="hljs"><code><div><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApplicationController</span> &lt; ActionController::Base</span>
  <span class="hljs-comment"># Prevent CSRF attacks by raising an exception.</span>
  <span class="hljs-comment"># For APIs, you may want to use :null_session instead.</span>
  protect_from_forgery <span class="hljs-symbol">with:</span> <span class="hljs-symbol">:exception</span>

  <span class="hljs-comment"># define current_user and logged_in? as helper methods</span>
  helper_method <span class="hljs-symbol">:current_user</span>, <span class="hljs-symbol">:logged_in?</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">current_user</span></span>
    <span class="hljs-comment"># Fing the user that matches the user_id stored in session.</span>
    @current_user <span class="hljs-params">||</span>= User.find_by(<span class="hljs-symbol">id:</span> session[<span class="hljs-symbol">:user_id</span>])
  <span class="hljs-keyword">end</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">logged_in?</span></span>
    <span class="hljs-comment"># check if the current_user has a value. nil? returns a boolean</span>
    !current_user.<span class="hljs-literal">nil</span>?
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</div></code></pre>
<p>The <code>current_user</code> method depends on the <code>user_id</code> that we add to the session when logging in or registering.</p>
<p>Lets update <code>app/views/sessions/welcome.html.erb</code> to use these new helper methods. Add some embedded ruby code to check if <code>logged_in?</code> is true and if it is then print out a message along with the email for the logged in user.</p>
<pre class="hljs"><code><div><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Welcome<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>You have successfully logged in!<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">%</span></span></span><span class="ruby"> <span class="hljs-keyword">if</span> logged_in? </span><span class="xml"><span class="hljs-tag">%&gt;</span>
  Welcome <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> current_user.email </span><span class="xml"><span class="hljs-tag">%&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">%</span></span></span><span class="ruby"> <span class="hljs-keyword">end</span> </span><span class="xml"><span class="hljs-tag">%&gt;</span>
</span></div></code></pre>
<p>Refresh the welcome page now and you will see the message!
<img src="screenshots/welcome_message.png" alt="Welcome page message"></p>
<p>There are also a few other changes we can make using the new helper methods. Lets update the navigation menu so that the register and login links don't show when you are logged in.</p>
<p>Open <code>app/views/layouts/application.html.erb</code> and use the <code>logged_in?</code> helper function to only show the <code>Register</code> and <code>Login</code> menu items if <code>logged_in?</code> is <code>false</code>. The menu will look like this with the change.</p>
<pre class="hljs"><code><div><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar-nav mr-auto"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> link_to <span class="hljs-string">'Home'</span>, root_path, <span class="hljs-class"><span class="hljs-keyword">class</span>: '<span class="hljs-title">nav</span>-<span class="hljs-title">link</span>' </span></span><span class="xml"><span class="hljs-tag">%&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> link_to <span class="hljs-string">'About'</span>, about_path, <span class="hljs-class"><span class="hljs-keyword">class</span>: '<span class="hljs-title">nav</span>-<span class="hljs-title">link</span>' </span></span><span class="xml"><span class="hljs-tag">%&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">%</span></span></span><span class="ruby"> <span class="hljs-keyword">if</span> logged_in? == <span class="hljs-literal">false</span> </span><span class="xml"><span class="hljs-tag">%&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> link_to <span class="hljs-string">'Register'</span>, new_user_path, <span class="hljs-class"><span class="hljs-keyword">class</span>: '<span class="hljs-title">nav</span>-<span class="hljs-title">link</span>' </span></span><span class="xml"><span class="hljs-tag">%&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> link_to <span class="hljs-string">'Login'</span>, login_path, <span class="hljs-class"><span class="hljs-keyword">class</span>: '<span class="hljs-title">nav</span>-<span class="hljs-title">link</span>' </span></span><span class="xml"><span class="hljs-tag">%&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">%</span></span></span><span class="ruby"> <span class="hljs-keyword">end</span> </span><span class="xml"><span class="hljs-tag">%&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
</span></div></code></pre>
<p>Now refresh the browser and you will see the links are no longer shown.
<img src="screenshots/logged_in_menu.png" alt="Menu links"></p>
<h3 id="86-logout">8.6 Logout</h3>
<p>Now that we can login we need to be able to logout. First open <code>app/controllers/sessions_controller.rb</code> and add a new action called <code>logout</code>. This action will clear the <code>user_id</code> from the session and redirect to the login screen.</p>
<p>The <code>logout</code> action code will look like this.</p>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">logout</span></span>
  session[<span class="hljs-symbol">:user_id</span>] = <span class="hljs-literal">nil</span>
  redirect_to <span class="hljs-string">'/login'</span>
<span class="hljs-keyword">end</span>
</div></code></pre>
<p>Now we need to update the routes to provide access to the new logout action we added. Open <code>config/routes.rb</code> and add a new route for <code>logout</code> using get.</p>
<pre class="hljs"><code><div>get <span class="hljs-string">'logout'</span>, <span class="hljs-symbol">to:</span> <span class="hljs-string">'sessions#logout'</span>
</div></code></pre>
<p>Now we have the <code>logout</code> action and route setup lets update the navigation menu in <code>app/views/layouts/application.html.erb</code> and add a link to <code>logout</code>.</p>
<p>A few update to the menu and you will have something like this. I have updated to use an <code>if else</code> for <code>logged_in?</code>.</p>
<pre class="hljs"><code><div><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar-nav mr-auto"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> link_to <span class="hljs-string">'Home'</span>, root_path, <span class="hljs-class"><span class="hljs-keyword">class</span>: '<span class="hljs-title">nav</span>-<span class="hljs-title">link</span>' </span></span><span class="xml"><span class="hljs-tag">%&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> link_to <span class="hljs-string">'About'</span>, about_path, <span class="hljs-class"><span class="hljs-keyword">class</span>: '<span class="hljs-title">nav</span>-<span class="hljs-title">link</span>' </span></span><span class="xml"><span class="hljs-tag">%&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">%</span></span></span><span class="ruby"> <span class="hljs-keyword">if</span> logged_in? </span><span class="xml"><span class="hljs-tag">%&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> link_to <span class="hljs-string">'Logout'</span>, logout_path, <span class="hljs-class"><span class="hljs-keyword">class</span>: '<span class="hljs-title">nav</span>-<span class="hljs-title">link</span>' </span></span><span class="xml"><span class="hljs-tag">%&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">%</span></span></span><span class="ruby"> <span class="hljs-keyword">else</span> </span><span class="xml"><span class="hljs-tag">%&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> link_to <span class="hljs-string">'Register'</span>, new_user_path, <span class="hljs-class"><span class="hljs-keyword">class</span>: '<span class="hljs-title">nav</span>-<span class="hljs-title">link</span>' </span></span><span class="xml"><span class="hljs-tag">%&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> link_to <span class="hljs-string">'Login'</span>, login_path, <span class="hljs-class"><span class="hljs-keyword">class</span>: '<span class="hljs-title">nav</span>-<span class="hljs-title">link</span>' </span></span><span class="xml"><span class="hljs-tag">%&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">%</span></span></span><span class="ruby"> <span class="hljs-keyword">end</span> </span><span class="xml"><span class="hljs-tag">%&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
</span></div></code></pre>
<p>Now clicking on <code>Logout</code> will clear the session and redirect to the login page.</p>
<h3 id="87-push-to-github-and-open-a-pull-request">8.7 Push to Github and open a pull request</h3>
<p>Like before we need to push up the changes we have made to a new branch on Github and then open a pull request to merge the changes from the new branch to master.</p>
<ol>
<li>Run <code>git status</code> and review the list of changes. You should see a list like this.</li>
</ol>
<pre class="hljs"><code><div>On branch adding-user-login
Changes not staged for commit:
  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)
  (use &quot;git checkout -- &lt;file&gt;...&quot; to discard changes in working directory)

        modified:   app/controllers/application_controller.rb
        modified:   app/views/layouts/application.html.erb
        modified:   config/routes.rb

Untracked files:
  (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)

        app/assets/javascripts/sessions.js
        app/assets/stylesheets/sessions.scss
        app/controllers/sessions_controller.rb
        app/helpers/sessions_helper.rb
        app/views/sessions/
        spec/controllers/sessions_controller_spec.rb
        spec/helpers/sessions_helper_spec.rb
        spec/views/sessions/
</div></code></pre>
<ol start="2">
<li>We will need to add all of the changes so run <code>git add .</code> to add all of the changes.</li>
<li>Now that the changes are added lets create a new commit. <code>git commit -m 'Adding user login and logout'</code>. You should see the following output.</li>
</ol>
<pre class="hljs"><code><div>[adding-user-login ff79aba] Adding user login and logout
15 files changed, 150 insertions(+), 4 deletions(-)
create mode 100644 app/assets/javascripts/sessions.js
create mode 100644 app/assets/stylesheets/sessions.scss
create mode 100644 app/controllers/sessions_controller.rb
create mode 100644 app/helpers/sessions_helper.rb
create mode 100644 app/views/sessions/create.html.erb
create mode 100644 app/views/sessions/new.html.erb
create mode 100644 app/views/sessions/welcome.html.erb
create mode 100644 spec/controllers/sessions_controller_spec.rb
create mode 100644 spec/helpers/sessions_helper_spec.rb
create mode 100644 spec/views/sessions/create.html.erb_spec.rb
create mode 100644 spec/views/sessions/new.html.erb_spec.rb
create mode 100644 spec/views/sessions/welcome.html.erb_spec.rb
</div></code></pre>
<ol start="4">
<li>Push the commit to a new branch on Github. <code>git push -u origin adding-user-login</code>. You will see this output including output for creating the new remote branch.</li>
</ol>
<pre class="hljs"><code><div>Enumerating objects: 48, done.
Counting objects: 100% (48/48), done.
Delta compression using up to 8 threads
Compressing objects: 100% (29/29), done.
Writing objects: 100% (31/31), 4.14 KiB | 470.00 KiB/s, done.
Total 31 (delta 8), reused 0 (delta 0)
remote: Resolving deltas: 100% (8/8), completed with 6 local objects.
remote: 
remote: Create a pull request for 'adding-user-login' on GitHub by visiting:
remote:      https://github.com/jonathanmeaney/todo-app/pull/new/adding-user-login
remote: 
To github.com:jonathanmeaney/todo-app.git
 * [new branch]      adding-user-login -&gt; adding-user-login
Branch 'adding-user-login' set up to track remote branch 'adding-user-login' from 'origin'.
</div></code></pre>
<ol start="5">
<li>On Github it should alert you that a branch was created and a pull request can be made. Click on the <code>Compare &amp; pull request</code> button.
<img src="screenshots/compare_and_pr.png" alt="Compare and pr">.</li>
<li>After clicking the <code>Compare &amp; pull request</code> button you can add a title and description to the pull request and assign it to yourself. It should automatically configure the branches for you merging but still make sure the branch on the left is <code>master</code> and the one on the right is <code>adding-user-login</code>.
<img src="screenshots/new_login_pr_edit.png" alt="New logging in pr edit"></li>
<li>Click on <code>Create pull request</code> and you will have created the new pull request.
<img src="screenshots/new_login_pr.png" alt="New logging in pr"></li>
<li>Click on <code>Merge pull request</code> and then <code>Confirm merge</code>. The pull request has been merged into master.</li>
<li>Back in the <code>todo-app</code> directory run <code>git status</code> to make sure there are no changed files needed to be committed and then change branches back to master with <code>git checkout master</code>.</li>
<li>You will be notified there are changes on the remote that need to be synced with your local master. Run <code>git pull</code> to pull the latest changes (the user login/logout feature). Your local master is now up to date with the remote repository.</li>
</ol>
<h2 id="9-creating-the-todo-scaffolding">9 Creating the ToDo Scaffolding</h2>
<p>We can create a new user, login and logout so now its time to create the actual ToDos functionality.</p>
<h3 id="91-create-branch-for-todo">9.1 Create branch for ToDo</h3>
<p>First, as in the previous sections lets create a new branch to hold the ToDos work. Call the branch <code>adding-todos</code>. Make sure there are no changes that need to be committed or stashed by running <code>git status</code> then running the following command will create the branch and check it out.</p>
<pre class="hljs"><code><div>git checkout -b adding-todos
</div></code></pre>
<h3 id="92-scaffolding-todo">9.2 Scaffolding ToDo</h3>
<p>We're going to use a new Rails generator method called <code>scaffold</code>. This generator creates a controller, views, model and database migration all in one go. The scaffold method needs a name (usually singular, Rails will pluralize) which will be <code>ToDo</code> followed by a list of model attribute and data type pairs.</p>
<p>The ToDo has the following attributes; a title, a description, a boolean flag for completion and a reference to the user that created it. The non user fields are typical data types string and boolean but the <code>user</code> is a reference. This will generate a <code>user_id</code> column in the <code>to_dos</code> table. This column will be used to join the <code>ToDo</code> record with a <code>User</code> record.</p>
<pre class="hljs"><code><div>bundle exec rails generate scaffold ToDo title:string description:string completed:boolean user:references
</div></code></pre>
<p>Running the above command will generate the following output. You can see the migration, model, controller, views, tests and all the other pieces being generated in one go.</p>
<pre class="hljs"><code><div>invoke  active_record
create    db/migrate/20201030184852_create_to_dos.rb
create    app/models/to_do.rb
invoke    rspec
create      spec/models/to_do_spec.rb
invoke  resource_route
  route    resources :to_dos
invoke  scaffold_controller
create    app/controllers/to_dos_controller.rb
invoke    erb
create      app/views/to_dos
create      app/views/to_dos/index.html.erb
create      app/views/to_dos/edit.html.erb
create      app/views/to_dos/show.html.erb
create      app/views/to_dos/new.html.erb
create      app/views/to_dos/_form.html.erb
invoke    rspec
create      spec/controllers/to_dos_controller_spec.rb
create      spec/views/to_dos/edit.html.erb_spec.rb
create      spec/views/to_dos/index.html.erb_spec.rb
create      spec/views/to_dos/new.html.erb_spec.rb
create      spec/views/to_dos/show.html.erb_spec.rb
create      spec/routing/to_dos_routing_spec.rb
invoke      rspec
create        spec/requests/to_dos_spec.rb
invoke    helper
create      app/helpers/to_dos_helper.rb
invoke      rspec
create        spec/helpers/to_dos_helper_spec.rb
invoke    jbuilder
create      app/views/to_dos/index.json.jbuilder
create      app/views/to_dos/show.json.jbuilder
create      app/views/to_dos/_to_do.json.jbuilder
invoke  assets
invoke    js
create      app/assets/javascripts/to_dos.js
invoke    scss
create      app/assets/stylesheets/to_dos.scss
invoke  scss
create    app/assets/stylesheets/scaffolds.scss
</div></code></pre>
<p>Using the <code>scaffold</code> generator will create a controller that has typical CRUD (Create read update destroy) actions pre defined for the resource you are creating. The accompanying views will also support these pre defined actions. If you open <code>app/controllers/to_dos_controller.rb</code> you will see the different actions. The different CRUD actions are explained below.</p>
<table>
<tr><th>Action</th><th>Description</th></tr>
<tr><th>index</th><td>The <b>index</b> action is typically used to list all of the records of the resource type. The resource is `ToDo` in this case so all ToDos would be listed on this page.</td></tr>
<tr><th>show</th><td>The <b>show</b> action is used to show the details of a particular record.</td></tr>
<tr><th>new</th><td>The <b>new</b> action is used to house a form for creating a new record.</td></tr>
<tr><th>edit</th><td>The <b>edit</b> action is used to house a form for editing an existing record.</td></tr>
<tr><th>create</th><td>The <b>create</b> action is called from the form on the new page and is responsible for actually creating the new record.</td></tr>
<tr><th>update</th><td>The <b>update</b> action is called from the form on the edit page and is responsible for actually updating the existing record.</td></tr>
<tr><th>destroy</th><td>The <b>destroy</b> action is used to destroy a record.</td></tr>
</table>
<p>### 9.3 Updating User associations
The ToDo scaffold has been created but we still need to create the table in the database so we need to use rake to run the migrations. Run the following command:</p>
<pre class="hljs"><code><div>bundle exec rake db:migrate
</div></code></pre>
<p>You will get the output saying the new table has been created:</p>
<pre class="hljs"><code><div>== 20201030184852 CreateToDos: migrating ======================================
-- create_table(:to_dos)
   -&gt; 0.2132s
== 20201030184852 CreateToDos: migrated (0.2133s) =============================
</div></code></pre>
<p>The <code>to_dos</code> table is in place and had a column which will be used to join to the <code>users</code> table. We need to define the relationship between these two tables in Rails.</p>
<p>If you open the <code>ToDo</code> model in <code>app/models/to_do.rb</code> you'll see that part of the relationship has already been created by the <code>scaffold</code> method. Because when we created the scaffold we specified <code>user:references</code> Rails knows that there needs to be a relationship between <code>ToDo</code> and <code>User</code> and references in this case means <code>belongs_to</code>. A <code>ToDo</code> belongs to a <code>User</code>. We need to add the other side of the relationship on the <code>User</code> model in <code>app/models/user.rb</code>.</p>
<p>Open <code>app/models/user.rb</code> and complete the relationship. The relationship between the <code>User</code> and the <code>ToDo</code> is a one to many relationship. A <code>User</code> can have many <code>ToDo</code> records, and a <code>ToDo</code> belongs to a <code>User</code>. Use the rails <code>has_many</code> association to finish the relationship. The final code in <code>app/models/user.rb</code> will look like this:</p>
<pre class="hljs"><code><div><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> &lt; ActiveRecord::Base</span>
  has_secure_password

  has_many <span class="hljs-symbol">:to_dos</span>
<span class="hljs-keyword">end</span>
</div></code></pre>
<p>Now the relationship between the two models is in place.</p>
<h3 id="94-updates-to-include-currentuser">9.4 Updates to include current_user</h3>
<p>If you open the <code>app/controllers/to_dos_controller.rb</code> we will make a few changes to include the <code>current_user</code> (logged in user) that we added previously.</p>
<p>Currently the <code>index</code> action will get all <code>ToDo</code> records to display. We should only get the records that belong to the user currently logged in. To do this we will update the <code>index</code> action and change <code>ToDo.all</code>. Instead of <code>ToDo.all</code> we will access the <code>current_user</code> method and call <code>to_dos</code> on it. This is accessing the relationship we just setup on the <code>User</code> model. Calling the <code>to_dos</code> relationship on the <code>current_user</code> object will retrieve all of the <code>ToDo</code> records associated with the logged in user by using the <code>ToDo</code> <code>user_id</code> column to join the two tables. the updated <code>index</code> action will look like this:</p>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">index</span></span>
  @to_dos = current_user.to_dos
<span class="hljs-keyword">end</span>
</div></code></pre>
<p>Next we're going to update the <code>to_do_params</code> method and remove <code>user_id</code> from it. We don't want <code>user_id</code> being submitted in the form to create a <code>ToDo</code>. The <code>user_id</code> field for the new <code>ToDo</code> record will be populated with the <code>id</code> from <code>current_user</code>. The updated method will look like this.</p>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">to_do_params</span></span>
  params.<span class="hljs-keyword">require</span>(<span class="hljs-symbol">:to_do</span>).permit(<span class="hljs-symbol">:title</span>, <span class="hljs-symbol">:description</span>, <span class="hljs-symbol">:completed</span>)
<span class="hljs-keyword">end</span>
</div></code></pre>
<p>Next update the <code>create</code> action to set the user for the new <code>ToDo</code> record. To do that you can call <code>@to_do.user = current_user</code> in the method. The updated method will look like this:</p>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create</span></span>
  @to_do = ToDo.new(to_do_params)
  @to_do.user = current_user

  respond_to <span class="hljs-keyword">do</span> <span class="hljs-params">|format|</span>
    <span class="hljs-keyword">if</span> @to_do.save
      format.html { redirect_to @to_do, <span class="hljs-symbol">notice:</span> <span class="hljs-string">'To do was successfully created.'</span> }
      format.json { render <span class="hljs-symbol">:show</span>, <span class="hljs-symbol">status:</span> <span class="hljs-symbol">:created</span>, <span class="hljs-symbol">location:</span> @to_do }
    <span class="hljs-keyword">else</span>
      format.html { render <span class="hljs-symbol">:new</span> }
      format.json { render <span class="hljs-symbol">json:</span> @to_do.errors, <span class="hljs-symbol">status:</span> <span class="hljs-symbol">:unprocessable_entity</span> }
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</div></code></pre>
<h3 id="95-update-ui">9.5 Update UI</h3>
<p>First we need to remove some SCSS that got added when running the <code>scaffold</code> generator. Delete the file <code>app/assets/stylesheets/scaffold.scss</code>. This will cause some conflicts with <code>Bootstrap</code>.</p>
<p>We need a link to get to the <code>ToDo</code> records. If you open <code>config/routes.rb</code> you will see that the <code>scaffold</code> generator also added <code>resources :to_dos</code> to the routes file. The <code>resources</code> method will auto generate routes for each of the actions in <code>app/controllers/to_dos_controller.rb</code>. If you run <code>bundle exec rake routes</code> you will see all the new routes available.</p>
<pre class="hljs"><code><div>    Prefix Verb   URI Pattern                Controller#Action
    to_dos GET    /to_dos(.:format)          to_dos#index
           POST   /to_dos(.:format)          to_dos#create
 new_to_do GET    /to_dos/new(.:format)      to_dos#new
edit_to_do GET    /to_dos/:id/edit(.:format) to_dos#edit
     to_do GET    /to_dos/:id(.:format)      to_dos#show
           PATCH  /to_dos/:id(.:format)      to_dos#update
           PUT    /to_dos/:id(.:format)      to_dos#update
           DELETE /to_dos/:id(.:format)      to_dos#destroy
      root GET    /                          site#index
     about GET    /about(.:format)           site#about
     users POST   /users(.:format)           users#create
  new_user GET    /users/new(.:format)       users#new
     login GET    /login(.:format)           sessions#new
           POST   /login(.:format)           sessions#create
   welcome GET    /welcome(.:format)         sessions#welcome
    logout GET    /logout(.:format)          sessions#logout
</div></code></pre>
<p>Open <code>app/views/layouts/application.html.erb</code>. We are going to add a link to the the <code>to_dos</code> controller <code>index</code> and it should only be available if you are logged in. Add a new link inside the <code>logged_in?</code> block. The link with go to the <code>to_dos_path</code> which will route to the <code>index</code> of the <code>to_dos_controller</code>.</p>
<pre class="hljs"><code><div><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> link_to <span class="hljs-string">'ToDos'</span>, to_dos_path, <span class="hljs-class"><span class="hljs-keyword">class</span>: '<span class="hljs-title">nav</span>-<span class="hljs-title">link</span>' </span></span><span class="xml"><span class="hljs-tag">%&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
</span></div></code></pre>
<p>The full navigation menu now looks like this:</p>
<pre class="hljs"><code><div><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar-nav mr-auto"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> link_to <span class="hljs-string">'Home'</span>, root_path, <span class="hljs-class"><span class="hljs-keyword">class</span>: '<span class="hljs-title">nav</span>-<span class="hljs-title">link</span>' </span></span><span class="xml"><span class="hljs-tag">%&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> link_to <span class="hljs-string">'About'</span>, about_path, <span class="hljs-class"><span class="hljs-keyword">class</span>: '<span class="hljs-title">nav</span>-<span class="hljs-title">link</span>' </span></span><span class="xml"><span class="hljs-tag">%&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">%</span></span></span><span class="ruby"> <span class="hljs-keyword">if</span> logged_in? </span><span class="xml"><span class="hljs-tag">%&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> link_to <span class="hljs-string">'ToDos'</span>, to_dos_path, <span class="hljs-class"><span class="hljs-keyword">class</span>: '<span class="hljs-title">nav</span>-<span class="hljs-title">link</span>' </span></span><span class="xml"><span class="hljs-tag">%&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> link_to <span class="hljs-string">'Logout'</span>, logout_path, <span class="hljs-class"><span class="hljs-keyword">class</span>: '<span class="hljs-title">nav</span>-<span class="hljs-title">link</span>' </span></span><span class="xml"><span class="hljs-tag">%&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">%</span></span></span><span class="ruby"> <span class="hljs-keyword">else</span> </span><span class="xml"><span class="hljs-tag">%&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> link_to <span class="hljs-string">'Register'</span>, new_user_path, <span class="hljs-class"><span class="hljs-keyword">class</span>: '<span class="hljs-title">nav</span>-<span class="hljs-title">link</span>' </span></span><span class="xml"><span class="hljs-tag">%&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> link_to <span class="hljs-string">'Login'</span>, login_path, <span class="hljs-class"><span class="hljs-keyword">class</span>: '<span class="hljs-title">nav</span>-<span class="hljs-title">link</span>' </span></span><span class="xml"><span class="hljs-tag">%&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">%</span></span></span><span class="ruby"> <span class="hljs-keyword">end</span> </span><span class="xml"><span class="hljs-tag">%&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
</span></div></code></pre>
<p>Now if you refresh the page you will see the <code>ToDos</code> link in the navigation bar. If you click on the link it will bring you to <code>app/views/to_dos/index.html.erb</code> which lists the <code>ToDo</code> records belonging to the logged in user.
<img src="screenshots/todos_index.png" alt="Todos index">
At the moment there are no <code>ToDo</code> records to display and if you click on the <code>New To Do</code> link it will bring you to the form for creating a new <code>ToDo</code>. You'll notice that the <code>New To Do</code> link was added by the <code>scaffold</code> generator. The generator adds links to connect up the pages created.
<img src="screenshots/new_todo.png" alt="Todos new">
We need to make a few updates to make the pages look better and integrate with <code>Bootstrap</code>.</p>
<p>First open <code>app/views/to_dos/index.html.erb</code> and replace its contents with</p>
<pre class="hljs"><code><div><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"notice"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> notice </span><span class="xml"><span class="hljs-tag">%&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Listing To Dos<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"table"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">thead</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>Description<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>Completed<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>User<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">th</span> <span class="hljs-attr">colspan</span>=<span class="hljs-string">"3"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">thead</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">tbody</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">%</span></span></span><span class="ruby"> @to_dos.each <span class="hljs-keyword">do</span> <span class="hljs-params">|to_do|</span> </span><span class="xml"><span class="hljs-tag">%&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> to_do.title </span><span class="xml"><span class="hljs-tag">%&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> to_do.description </span><span class="xml"><span class="hljs-tag">%&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> to_do.completed </span><span class="xml"><span class="hljs-tag">%&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> link_to <span class="hljs-string">'Show'</span>, to_do </span><span class="xml"><span class="hljs-tag">%&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> link_to <span class="hljs-string">'Edit'</span>, edit_to_do_path(to_do) </span><span class="xml"><span class="hljs-tag">%&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> link_to <span class="hljs-string">'Destroy'</span>, to_do, <span class="hljs-symbol">method:</span> <span class="hljs-symbol">:delete</span>, <span class="hljs-symbol">data:</span> { <span class="hljs-symbol">confirm:</span> <span class="hljs-string">'Are you sure?'</span> } </span><span class="xml"><span class="hljs-tag">%&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">%</span></span></span><span class="ruby"> <span class="hljs-keyword">end</span> </span><span class="xml"><span class="hljs-tag">%&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">tbody</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> link_to <span class="hljs-string">'New To do'</span>, new_to_do_path, <span class="hljs-class"><span class="hljs-keyword">class</span>: '<span class="hljs-title">btn</span> <span class="hljs-title">btn</span>-<span class="hljs-title">primary</span>' </span></span><span class="xml"><span class="hljs-tag">%&gt;</span>
</span></div></code></pre>
<p>There are just a few small changes adding in some <code>Bootstrap</code> classes to the table and new link to make it look like a button.</p>
<p>Now open <code>app/views/to_dos/_form_.html.erb</code>. This if the form that will appear on the <code>new</code> and <code>edit</code> pages. Replace the <code>_form.html.erb</code> content with the following:</p>
<pre class="hljs"><code><div><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> form_for(@to_do) <span class="hljs-keyword">do</span> <span class="hljs-params">|f|</span> </span><span class="xml"><span class="hljs-tag">%&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">%</span></span></span><span class="ruby"> <span class="hljs-keyword">if</span> @to_do.errors.any? </span><span class="xml"><span class="hljs-tag">%&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"error_explanation"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> pluralize(@to_do.errors.count, <span class="hljs-string">"error"</span>) </span><span class="xml"><span class="hljs-tag">%&gt;</span> prohibited this to_do from being saved:<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">%</span></span></span><span class="ruby"> @to_do.errors.full_messages.each <span class="hljs-keyword">do</span> <span class="hljs-params">|message|</span> </span><span class="xml"><span class="hljs-tag">%&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> message </span><span class="xml"><span class="hljs-tag">%&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">%</span></span></span><span class="ruby"> <span class="hljs-keyword">end</span> </span><span class="xml"><span class="hljs-tag">%&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">%</span></span></span><span class="ruby"> <span class="hljs-keyword">end</span> </span><span class="xml"><span class="hljs-tag">%&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> f.label <span class="hljs-symbol">:title</span> </span><span class="xml"><span class="hljs-tag">%&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> f.text_field <span class="hljs-symbol">:title</span>, <span class="hljs-class"><span class="hljs-keyword">class</span>: '<span class="hljs-title">form</span>-<span class="hljs-title">control</span>' </span></span><span class="xml"><span class="hljs-tag">%&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> f.label <span class="hljs-symbol">:description</span> </span><span class="xml"><span class="hljs-tag">%&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> f.text_field <span class="hljs-symbol">:description</span>, <span class="hljs-class"><span class="hljs-keyword">class</span>: '<span class="hljs-title">form</span>-<span class="hljs-title">control</span>' </span></span><span class="xml"><span class="hljs-tag">%&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"actions"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> f.submit <span class="hljs-class"><span class="hljs-keyword">class</span>: '<span class="hljs-title">btn</span> <span class="hljs-title">btn</span>-<span class="hljs-title">primary</span> <span class="hljs-title">btn</span>-<span class="hljs-title">block</span>' </span></span><span class="xml"><span class="hljs-tag">%&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">%</span></span></span><span class="ruby"> <span class="hljs-keyword">end</span> </span><span class="xml"><span class="hljs-tag">%&gt;</span>
</span></div></code></pre>
<p>The changes are adding some <code>Bootstrap</code> classes to the fields and submit and removing some fields that shouldn't be in the form like <code>user_id</code> and <code>completed</code>. If you view the <code>new</code> <code>ToDo</code> page now it will look like this.
<img src="screenshots/new_todo_form_bootstrap.png" alt="New ToDo Page Bootstrap"></p>
<p>Now open <code>app/views/to_dos/show.html.erb</code> and replace it with the following:</p>
<pre class="hljs"><code><div><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"notice"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> notice </span><span class="xml"><span class="hljs-tag">%&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>Title:<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> @to_do.title </span><span class="xml"><span class="hljs-tag">%&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>Description:<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> @to_do.description </span><span class="xml"><span class="hljs-tag">%&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>Completed:<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> @to_do.completed </span><span class="xml"><span class="hljs-tag">%&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> link_to <span class="hljs-string">'Edit'</span>, edit_to_do_path(@to_do) </span><span class="xml"><span class="hljs-tag">%&gt;</span> |
<span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> link_to <span class="hljs-string">'Back'</span>, to_dos_path </span><span class="xml"><span class="hljs-tag">%&gt;</span>
</span></div></code></pre>
<p>The change is small, just removing the <code>user</code> section. This doesn't need to be shown on each <code>ToDo</code>.</p>
<p>Now if you reload the <code>index</code> page for <code>ToDos</code> you will see the list of <code>ToDo</code> records you have created.
<img src="screenshots/toso_list.png" alt="Todo List">
If you click on the <code>Show</code> link for a record you will see the <code>show</code> page.
<img src="screenshots/todo_show.png" alt="Todo Show"></p>
<h3 id="96-authorized-page-access">9.6 Authorized page access</h3>
<p>Lets add an additional security feature to <code>app/controllers/to_dos_controller.rb</code>. We can add an additional check to make sure someone is logged in before accessing any of the actions.</p>
<p>Open <code>app/controllers/to_dos_controller.rb</code> and add a new private method called <code>authorized</code>. This method will <code>redirect_to</code> the login page if no one is logged in.</p>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">authorized</span></span>
  redirect_to <span class="hljs-string">'/login'</span> <span class="hljs-keyword">unless</span> logged_in?
<span class="hljs-keyword">end</span>
</div></code></pre>
<p>To call this method we're going to register is as a <code>before_filter</code>. A before filter method will be called before accessing any of the controller actions. So before any of the actions in the <code>to_dos_controller</code> are called a check if made to make sure someone is logged in, and if they aren't they will be redirected to login. Register the method as a <code>before filter</code> using this code: <code>before_action :authorized</code>. The <code>ToDosController</code> code looks like this after making the change adding the <code>before_filter</code>.</p>
<pre class="hljs"><code><div><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ToDosController</span> &lt; ApplicationController</span>
  before_action <span class="hljs-symbol">:authorized</span>
  before_action <span class="hljs-symbol">:set_to_do</span>, <span class="hljs-symbol">only:</span> [<span class="hljs-symbol">:show</span>, <span class="hljs-symbol">:edit</span>, <span class="hljs-symbol">:update</span>, <span class="hljs-symbol">:destroy</span>]

  <span class="hljs-comment"># GET /to_dos</span>
  <span class="hljs-comment"># GET /to_dos.json</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">index</span></span>
    @to_dos = current_user.to_dos
  <span class="hljs-keyword">end</span>

  <span class="hljs-comment"># GET /to_dos/1</span>
  <span class="hljs-comment"># GET /to_dos/1.json</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span></span>
  <span class="hljs-keyword">end</span>

  <span class="hljs-comment"># GET /to_dos/new</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">new</span></span>
    @to_do = ToDo.new
  <span class="hljs-keyword">end</span>

  <span class="hljs-comment"># GET /to_dos/1/edit</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span></span>
  <span class="hljs-keyword">end</span>

  <span class="hljs-comment"># POST /to_dos</span>
  <span class="hljs-comment"># POST /to_dos.json</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create</span></span>
    @to_do = ToDo.new(to_do_params)
    @to_do.user = current_user

    respond_to <span class="hljs-keyword">do</span> <span class="hljs-params">|format|</span>
      <span class="hljs-keyword">if</span> @to_do.save
        format.html { redirect_to @to_do, <span class="hljs-symbol">notice:</span> <span class="hljs-string">'To do was successfully created.'</span> }
        format.json { render <span class="hljs-symbol">:show</span>, <span class="hljs-symbol">status:</span> <span class="hljs-symbol">:created</span>, <span class="hljs-symbol">location:</span> @to_do }
      <span class="hljs-keyword">else</span>
        format.html { render <span class="hljs-symbol">:new</span> }
        format.json { render <span class="hljs-symbol">json:</span> @to_do.errors, <span class="hljs-symbol">status:</span> <span class="hljs-symbol">:unprocessable_entity</span> }
      <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>

  <span class="hljs-comment"># PATCH/PUT /to_dos/1</span>
  <span class="hljs-comment"># PATCH/PUT /to_dos/1.json</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span></span>
    respond_to <span class="hljs-keyword">do</span> <span class="hljs-params">|format|</span>
      <span class="hljs-keyword">if</span> @to_do.update(to_do_params)
        format.html { redirect_to @to_do, <span class="hljs-symbol">notice:</span> <span class="hljs-string">'To do was successfully updated.'</span> }
        format.json { render <span class="hljs-symbol">:show</span>, <span class="hljs-symbol">status:</span> <span class="hljs-symbol">:ok</span>, <span class="hljs-symbol">location:</span> @to_do }
      <span class="hljs-keyword">else</span>
        format.html { render <span class="hljs-symbol">:edit</span> }
        format.json { render <span class="hljs-symbol">json:</span> @to_do.errors, <span class="hljs-symbol">status:</span> <span class="hljs-symbol">:unprocessable_entity</span> }
      <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>

  <span class="hljs-comment"># DELETE /to_dos/1</span>
  <span class="hljs-comment"># DELETE /to_dos/1.json</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">destroy</span></span>
    @to_do.destroy
    respond_to <span class="hljs-keyword">do</span> <span class="hljs-params">|format|</span>
      format.html { redirect_to to_dos_url, <span class="hljs-symbol">notice:</span> <span class="hljs-string">'To do was successfully destroyed.'</span> }
      format.json { head <span class="hljs-symbol">:no_content</span> }
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>

  private
    <span class="hljs-comment"># Use callbacks to share common setup or constraints between actions.</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">set_to_do</span></span>
      @to_do = ToDo.find(params[<span class="hljs-symbol">:id</span>])
    <span class="hljs-keyword">end</span>

    <span class="hljs-comment"># Never trust parameters from the scary internet, only allow the white list through.</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">to_do_params</span></span>
      params.<span class="hljs-keyword">require</span>(<span class="hljs-symbol">:to_do</span>).permit(<span class="hljs-symbol">:title</span>, <span class="hljs-symbol">:description</span>, <span class="hljs-symbol">:completed</span>)
    <span class="hljs-keyword">end</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">authorized</span></span>
      redirect_to <span class="hljs-string">'/login'</span> <span class="hljs-keyword">unless</span> logged_in?
    <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</div></code></pre>
<h3 id="97-push-changes-open-pull-request-merge">9.7 Push changes, open pull request, merge</h3>
<p>As in the previous sections.</p>
<ol>
<li>Check all the changes made with <code>git status</code></li>
<li>Add all the changes with <code>git add .</code></li>
<li>Create a commit with <code>git commit -m 'Adding ToDo functionality'</code></li>
<li>Push to github <code>git push -u origin adding-todos</code></li>
<li>On Github open a pull request mergin <code>adding-todos</code> branch into <code>master</code></li>
<li>Merge the pull request</li>
<li>Back in local <code>todo-app</code> checkout master with <code>git checkout master</code></li>
<li>Pull the latest master with <code>git pull</code></li>
</ol>
<h2 id="10-next-steps">10 Next Steps</h2>
<ol>
<li>Add functionality to allow you to complete a ToDo.</li>
<li>Add filters to the ToDo list to show completed and not completed ToDos separately.</li>
<li>Add an option to export ToDos in JSON format.</li>
</ol>

</body>
</html>
